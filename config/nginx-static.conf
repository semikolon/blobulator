# Blobulator static file nginx config
# For manual deployment without Docker/Kamal
# Copy to Dell: /etc/nginx/sites-available/blobulator

server {
    listen 80;
    listen [::]:80;
    server_name blobulator.fredrikbranstrom.se voidulator.fredrikbranstrom.se;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name blobulator.fredrikbranstrom.se voidulator.fredrikbranstrom.se;

    # SSL certs - get with: sudo certbot certonly --nginx -d blobulator.fredrikbranstrom.se -d voidulator.fredrikbranstrom.se
    ssl_certificate     /etc/letsencrypt/live/blobulator.fredrikbranstrom.se/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/blobulator.fredrikbranstrom.se/privkey.pem;

    # Security headers
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;

    # Static files root
    root /var/www/blobulator;
    index index.html;

    # SPA routing - all paths serve index.html
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
